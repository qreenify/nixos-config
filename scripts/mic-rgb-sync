#!/usr/bin/env bash
# Sync RGB lighting with microphone status
# Red when muted, cyan when active

set -euo pipefail

# Get mic mute status using wpctl (works on NixOS)
if wpctl get-volume @DEFAULT_AUDIO_SOURCE@ 2>/dev/null | grep -q '\[MUTED\]'; then
    MIC_MUTED="1"
else
    MIC_MUTED="0"
fi

if [ "$MIC_MUTED" = "1" ]; then
    # Muted: Red (GPU device 0 + Motherboard device 2)
    openrgb --device 0 --mode Direct --color FF0000 >/dev/null 2>&1 &
    openrgb --device 2 --mode Direct --color FF0000 >/dev/null 2>&1 &
else
    # Active: Light blue with green (GPU device 0 + Motherboard device 2)
    openrgb --device 0 --mode Direct --color 00D4AA >/dev/null 2>&1 &
    openrgb --device 2 --mode Direct --color 00D4AA >/dev/null 2>&1 &
fi
